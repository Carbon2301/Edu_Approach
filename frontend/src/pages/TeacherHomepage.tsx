import { useEffect, useState } from 'react';import { useNavigate } from 'react-router-dom';import { Search, Plus, Eye, User, GraduationCap, ChevronLeft, ChevronRight } from 'lucide-react';import { useLanguage } from '../contexts/LanguageContext';import LanguageSelector from '../components/LanguageSelector';import Logo from '../components/Logo';import { classApi } from '../services/classApi';import { api } from '../services/api';const getClassColor = (classId: string): string => {  const colors = [    '#3b82f6', 
    '#10b981', 
    '#f59e0b', 
    '#ef4444', 
    '#8b5cf6', 
    '#ec4899', 
    '#06b6d4', 
    '#14b8a6', 
    '#f97316', 
    '#6366f1', 
    '#84cc16', 
    '#22c55e', 
  ];  let hash = 0;  for (let i = 0; i < classId.length; i++) {    hash = classId.charCodeAt(i) + ((hash << 5) - hash);  }  const index = Math.abs(hash) % colors.length;  return colors[index];};const TeacherHomepage = () => {  const navigate = useNavigate();  const { t, language } = useLanguage();  const [classes, setClasses] = useState<any[]>([]);  const [allClasses, setAllClasses] = useState<any[]>([]); 
  const [user, setUser] = useState<any>(null);  const [isLoading, setIsLoading] = useState(true);  const [searchQuery, setSearchQuery] = useState('');  const [currentPage, setCurrentPage] = useState(1);  const [pagination, setPagination] = useState<any>(null);  const [isInitialLoad, setIsInitialLoad] = useState(true);  useEffect(() => {    loadData();  }, []);  useEffect(() => {    if (!isInitialLoad) {      setCurrentPage(1);    }  }, [searchQuery]);  useEffect(() => {    if (!isInitialLoad && !isLoading) {      loadClasses(searchQuery || undefined, currentPage);    }  }, [currentPage, searchQuery]);  const loadData = async () => {    setIsLoading(true);    try {      const userResult = await api.getCurrentUser();      if (userResult.success && userResult.data) {        setUser(userResult.data.user);      }      const result = await classApi.getClasses(undefined, 1, 1);      if (result.success && result.data) {        const hasClasses = (result.data.pagination?.totalItems || 0) > 0;        if (hasClasses) {          await loadClasses(undefined, 1);        } else {          setAllClasses([]);          setClasses([]);        }      }    } catch (error) {      console.error('Load data error:', error);    } finally {      setIsLoading(false);      setIsInitialLoad(false);    }  };  const loadClasses = async (search?: string, page: number = 1) => {    try {      const result = await classApi.getClasses(search, page);      if (result.success && result.data) {        setClasses(result.data.classes || []);        setPagination(result.data.pagination || null);        if (!search && page === 1) {          const totalCount = result.data.pagination?.totalItems || 0;          setAllClasses(totalCount > 0 ? ['hasClasses'] : []);        }      }    } catch (error) {      console.error('Load classes error:', error);    }  };  const handleCreateClass = () => {    navigate('/teacher/classes/create');  };  const handleClassClick = (classId: string) => {    navigate(`/teacher/classes/${classId}`);  };  if (isLoading) {    return (      <div className="min-h-screen bg-gray-50 flex items-center justify-center">        <div className="text-center">          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>          <p className="mt-4 text-gray-600">{t('loading')}</p>        </div>      </div>    );  }  return (    <div className="min-h-screen bg-gray-50">      {}      <div className="fixed left-0 top-0 bottom-0 w-64 bg-white border-r-2 border-gray-900 flex flex-col z-10">        {}        <div className="px-6 py-6">          <Logo size={40} showText={true} />        </div>        {}        <div className="flex-1" />        {}        {user && (          <div             onClick={() => navigate('/teacher/profile')}            className="cursor-pointer hover:bg-gray-100 p-3 mx-4 mb-4 transition-colors"          >            <div className="flex items-center gap-3">              {user.profileImage ? (                <img                  src={user.profileImage}                  alt="Profile"                  className="w-12 h-12 rounded-full object-cover border-2 border-gray-900 flex-shrink-0"                />              ) : (                <div className="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center border-2 border-gray-900 flex-shrink-0">                  <User size={24} className="text-gray-400" />                </div>              )}              <div className="flex-1 min-w-0">                <p className="font-bold text-gray-900 text-sm truncate">                  {user.name}                </p>                <p className="text-xs text-gray-600 truncate">                  {user.email}                </p>              </div>            </div>          </div>        )}      </div>      {}      <div className="ml-64">        {}        <header className="bg-white border-b-2 border-gray-900">          <div className="container mx-auto px-4 py-4">            <div className="flex items-center justify-between gap-4">              {}              <div className="flex-1 max-w-2xl">                <div className="relative">                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />                  <input                    type="text"                    placeholder={t('searchClass')}                    value={searchQuery}                    onChange={(e) => setSearchQuery(e.target.value)}                    className="w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-md focus:outline-none focus:border-gray-900"                  />                </div>              </div>              {}              <div className="flex items-center gap-3">                <LanguageSelector />                <button                  onClick={handleCreateClass}                  className="px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors flex items-center gap-2 font-medium"                >                  <Plus size={20} />                  <span>{t('createClass')}</span>                </button>              </div>            </div>          </div>        </header>        {}        <main className="container mx-auto px-4 py-8">          {classes.length === 0 ? (            <div className="text-center py-16">              {allClasses.length === 0 ? (                <>                  <p className="text-gray-600 text-lg mb-4">{t('noClasses')}</p>                  <button                    onClick={handleCreateClass}                    className="px-6 py-3 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors"                  >                    {t('createFirstClass')}                  </button>                </>              ) : (                <p className="text-gray-600 text-lg">{t('noSearchResults')}</p>              )}            </div>          ) : (            <>              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">                {classes.map((classItem) => (                  <div                    key={classItem._id}                    onClick={() => handleClassClick(classItem._id)}                    className="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow cursor-pointer border-2 border-gray-200 hover:border-gray-900 overflow-hidden"                  >                    {}                    <div                       className="w-full h-48 flex items-center justify-center rounded-t-lg"                      style={{ backgroundColor: getClassColor(classItem._id) }}                    >                      <GraduationCap className="text-white" size={80} strokeWidth={1.5} />                    </div>                    {}                    <div className="p-4">                      <h3 className="text-xl font-bold text-gray-900 mb-2">                        {language === 'ja' ? 'クラス ' : 'Lớp '}{classItem.name}                      </h3>                      <p className="text-sm text-gray-600 mb-4 line-clamp-2">                        {classItem.description || t('noDescription')}                      </p>                      <div className="text-xs text-gray-500">                        {classItem.students?.length || 0} {t('students')}                      </div>                    </div>                  </div>                ))}              </div>              {}              {pagination && pagination.totalPages > 1 && (                <div className="mt-8 flex items-center justify-center gap-2">                  <button                    onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}                    disabled={currentPage === 1}                    className="px-4 py-2 bg-white border-2 border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"                  >                    <ChevronLeft size={20} />                  </button>                  <div className="flex items-center gap-1">                    {Array.from({ length: Math.min(5, pagination.totalPages) }, (_, i) => {                      let pageNum;                      if (pagination.totalPages <= 5) {                        pageNum = i + 1;                      } else if (currentPage <= 3) {                        pageNum = i + 1;                      } else if (currentPage >= pagination.totalPages - 2) {                        pageNum = pagination.totalPages - 4 + i;                      } else {                        pageNum = currentPage - 2 + i;                      }                      return (                        <button                          key={pageNum}                          onClick={() => setCurrentPage(pageNum)}                          className={`px-4 py-2 rounded-md transition-colors ${                            currentPage === pageNum                              ? 'bg-gray-900 text-white'                              : 'bg-white border-2 border-gray-300 hover:bg-gray-50'                          }`}                        >                          {pageNum}                        </button>                      );                    })}                  </div>                  <button                    onClick={() => setCurrentPage(prev => Math.min(pagination.totalPages, prev + 1))}                    disabled={currentPage === pagination.totalPages}                    className="px-4 py-2 bg-white border-2 border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"                  >                    <ChevronRight size={20} />                  </button>                </div>              )}            </>          )}        </main>      </div>    </div>  );};export default TeacherHomepage;