import { useState, useEffect } from 'react';import { useNavigate } from 'react-router-dom';import { useLanguage } from '../contexts/LanguageContext';import { useToastMessage } from '../contexts/ToastContext';import LanguageSelector from '../components/LanguageSelector';import Logo from '../components/Logo';import { api } from '../services/api';const GoogleRoleSelection = () => {  const navigate = useNavigate();  const { t, language } = useLanguage();  const toast = useToastMessage();  const [role, setRole] = useState<'student' | 'teacher'>('student');  const [formData, setFormData] = useState({    name: '',    gender: '' as 'male' | 'female' | 'other' | '',    studentId: '',    selfIntro: '',  });  const [errors, setErrors] = useState<{ [key: string]: string }>({});  const [isLoading, setIsLoading] = useState(false);  useEffect(() => {  }, []);  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {    const { name, value } = e.target;    setFormData(prev => ({ ...prev, [name]: value }));    if (errors[name]) {      setErrors(prev => ({ ...prev, [name]: '' }));    }  };  const validateForm = () => {    const newErrors: { [key: string]: string } = {};    if (!formData.name.trim()) {      newErrors.name = language === 'ja' ? '名前が必要です' : 'Vui lòng nhập tên';    }    if (!formData.gender) {      newErrors.gender = language === 'ja' ? '性別を選択してください' : 'Vui lòng chọn giới tính';    }    if (role === 'student' && !formData.studentId.trim()) {      newErrors.studentId = language === 'ja' ? '学生IDが必要です' : 'Vui lòng nhập MSSV';    }    setErrors(newErrors);    return Object.keys(newErrors).length === 0;  };  const handleSubmit = async (e: React.FormEvent) => {    e.preventDefault();    if (!validateForm()) return;    setIsLoading(true);    try {      const result = await api.completeGoogleRegistration({        role,        name: formData.name.trim(),        gender: formData.gender as 'male' | 'female' | 'other',        studentId: role === 'student' ? formData.studentId.trim() : undefined,        selfIntro: formData.selfIntro.trim() || undefined,      });      if (result.success) {        toast.success('registrationCompleted');        setTimeout(() => {          if (role === 'teacher') {            navigate('/teacher/home');          } else {            navigate('/dashboard');          }        }, 1500);      } else {        setErrors({ submit: result.message || t('registrationFailed') });      }    } catch (error: any) {      setErrors({ submit: error.message || t('registrationFailed') });    } finally {      setIsLoading(false);    }  };  return (    <div className="min-h-screen bg-gray-50">      {}      <header className="bg-white border-b border-gray-200">        <div className="container mx-auto px-4 py-4">          <div className="flex justify-between items-center">            <button              onClick={() => navigate('/')}              className="hover:opacity-80 transition-opacity"            >              <Logo size={40} showText={true} />            </button>            <LanguageSelector />          </div>        </div>      </header>      {}      <main className="container mx-auto px-4 py-12">        <div className="max-w-md mx-auto">          <div className="bg-white rounded-lg shadow-lg p-8 border-2 border-gray-900">            {}            <div className="text-center mb-8">              <h1 className="text-3xl font-bold text-gray-900 mb-2">                {language === 'ja' ? '役割を選択' : 'Chọn vai trò của bạn'}              </h1>              <p className="text-gray-600">                {language === 'ja'                   ? 'アカウント登録を完了するには、役割を選択してください'                   : 'Vui lòng chọn vai trò để hoàn tất đăng ký'}              </p>            </div>            {}            <form onSubmit={handleSubmit} className="space-y-5">              {}              <div>                <label className="block text-sm font-medium text-gray-700 mb-3">                  {t('userRole')} <span className="text-red-500">*</span>                </label>                <div className="flex gap-4">                  <label className="flex items-center cursor-pointer">                    <input                      type="radio"                      name="role"                      value="student"                      checked={role === 'student'}                      onChange={(e) => {                        setRole(e.target.value as 'student' | 'teacher');                        setErrors({});                      }}                      className="w-4 h-4 text-gray-900 focus:ring-gray-900 border-gray-300"                    />                    <span className="ml-2 text-sm text-gray-700">{t('student')}</span>                  </label>                  <label className="flex items-center cursor-pointer">                    <input                      type="radio"                      name="role"                      value="teacher"                      checked={role === 'teacher'}                      onChange={(e) => {                        setRole(e.target.value as 'student' | 'teacher');                        setErrors({});                      }}                      className="w-4 h-4 text-gray-900 focus:ring-gray-900 border-gray-300"                    />                    <span className="ml-2 text-sm text-gray-700">{t('teacher')}</span>                  </label>                </div>              </div>              {}              <div>                <label className="block text-sm font-medium text-gray-700 mb-1">                  {t('name')} <span className="text-red-500">*</span>                </label>                <input                  type="text"                  name="name"                  value={formData.name}                  onChange={handleInputChange}                  className={`input-field ${errors.name ? 'border-red-500' : ''}`}                />                {errors.name && (                  <p className="mt-1 text-sm text-red-600">{errors.name}</p>                )}              </div>              {}              <div>                <label className="block text-sm font-medium text-gray-700 mb-1">                  {language === 'ja' ? '性別' : 'Giới tính'} <span className="text-red-500">*</span>                </label>                <select                  name="gender"                  value={formData.gender}                  onChange={(e) => {                    setFormData(prev => ({ ...prev, gender: e.target.value as any }));                    if (errors.gender) {                      setErrors(prev => ({ ...prev, gender: '' }));                    }                  }}                  className={`input-field ${errors.gender ? 'border-red-500' : ''}`}                >                  <option value="">{language === 'ja' ? '選択してください' : 'Chọn giới tính'}</option>                  <option value="male">{language === 'ja' ? '男性' : 'Nam'}</option>                  <option value="female">{language === 'ja' ? '女性' : 'Nữ'}</option>                  <option value="other">{language === 'ja' ? 'その他' : 'Khác'}</option>                </select>                {errors.gender && (                  <p className="mt-1 text-sm text-red-600">{errors.gender}</p>                )}              </div>              {}              {role === 'student' && (                <div>                  <label className="block text-sm font-medium text-gray-700 mb-1">                    {t('studentId')} <span className="text-red-500">*</span>                  </label>                  <input                    type="text"                    name="studentId"                    value={formData.studentId}                    onChange={handleInputChange}                    placeholder={language === 'ja' ? '学生IDを入力' : 'Nhập MSSV'}                    className={`input-field ${errors.studentId ? 'border-red-500' : ''}`}                  />                  {errors.studentId && (                    <p className="mt-1 text-sm text-red-600">{errors.studentId}</p>                  )}                </div>              )}              {}              <div>                <label className="block text-sm font-medium text-gray-700 mb-1">                  {t('selfIntro')}                </label>                <textarea                  name="selfIntro"                  value={formData.selfIntro}                  onChange={handleInputChange}                  rows={4}                  className="input-field resize-none"                />              </div>              {}              {errors.submit && (                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">                  {errors.submit}                </div>              )}              {}              <button                type="submit"                className="btn-primary mt-6 w-full"                disabled={isLoading}              >                {isLoading                   ? (language === 'ja' ? '処理中...' : 'Đang xử lý...')                   : (language === 'ja' ? '登録完了' : 'Hoàn tất')}              </button>            </form>          </div>        </div>      </main>    </div>  );};export default GoogleRoleSelection;