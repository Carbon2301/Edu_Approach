import { useEffect, useState } from 'react';import { Sparkles, AlertCircle } from 'lucide-react';import { useLanguage } from '../contexts/LanguageContext';import { useToastMessage } from '../contexts/ToastContext';import { aiApi } from '../services/aiApi';const AIRecommendations = () => {  const { language } = useLanguage();  const toast = useToastMessage();  const [recommendations, setRecommendations] = useState<any>(null);  const [isLoading, setIsLoading] = useState(true);  const [isGenerating, setIsGenerating] = useState(false);  useEffect(() => {    const initialize = async () => {      await loadRecommendations();      await checkAndAutoGenerate();    };    initialize();  }, []); 
  const checkAndAutoGenerate = async () => {    try {      const statusResult = await aiApi.checkStatus();      if (statusResult.success && statusResult.data) {        const { hasRecommendations, needsUpdate, hasOceanResult, hasLogicalResult } = statusResult.data;        if ((!hasRecommendations && (hasOceanResult || hasLogicalResult)) || needsUpdate) {          setIsGenerating(true);          try {            const result = await aiApi.generateRecommendations();            if (result.success) {              await loadRecommendations();            }          } catch (error) {            console.error('Auto-generate error:', error);          } finally {            setIsGenerating(false);          }        }      }    } catch (error) {      console.error('Auto-generate check error:', error);    }  };  const loadRecommendations = async () => {    setIsLoading(true);    try {      const result = await aiApi.getRecommendations();      if (result.success && result.data) {        setRecommendations(result.data.recommendation);      }    } catch (error) {      console.error('Load recommendations error:', error);    } finally {      setIsLoading(false);    }  };  const handleGenerate = async (silent = false) => {    setIsGenerating(true);    try {      const result = await aiApi.generateRecommendations();      if (result.success) {        await loadRecommendations();        if (!silent) {          toast.success('aiRecommendationGenerated');        }      } else {        if (!silent) {          toast.error('aiRecommendationFailed', result.message);        }      }    } catch (error) {      console.error('Generate error:', error);    } finally {      setIsGenerating(false);    }  };  if (isLoading || isGenerating) {    return (      <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-8 border-2 border-blue-200 text-center">        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"></div>        <p className="text-gray-600">          {isGenerating             ? (language === 'ja' ? 'AI分析中...' : 'AI đang phân tích...')            : (language === 'ja' ? '読み込み中...' : 'Đang tải...')}        </p>      </div>    );  }  if (!recommendations) {    return (      <div className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-8 border-2 border-yellow-200">        <div className="text-center">          <AlertCircle size={48} className="mx-auto text-yellow-600 mb-3" />          <h3 className="font-bold text-gray-900 mb-2">            {language === 'ja' ? 'AI推奨がまだありません' : 'Chưa có gợi ý AI'}          </h3>          <p className="text-sm text-gray-600">            {language === 'ja'               ? 'クイズを完了すると、AIが自動的に学習アドバイスを生成します'              : 'Hoàn thành quiz và AI sẽ tự động tạo lời khuyên học tập'}          </p>        </div>      </div>    );  }  const recs = recommendations.recommendations?.[language] || recommendations.recommendations?.ja || [];  return (    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 border-2 border-blue-200">      <div className="flex justify-between items-start mb-4">        <div className="flex items-center gap-2">          <Sparkles size={24} className="text-blue-600" />          <h3 className="font-bold text-gray-900">            {language === 'ja' ? 'AI学習推奨' : 'Gợi ý học tập AI'}          </h3>        </div>      </div>      {!recs || recs.length === 0 ? (        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">          <p className="text-yellow-800 text-sm">            {language === 'ja'               ? 'AI推奨が生成中です。しばらくお待ちください...'              : 'AI đang tạo gợi ý. Vui lòng đợi...'}          </p>        </div>      ) : (        <div className="space-y-3">          {recs.map((rec: string, index: number) => (            <div              key={index}              className="flex gap-3 p-4 bg-white rounded-lg border border-blue-200 hover:border-blue-400 transition-colors"            >              <div className="flex-shrink-0 w-7 h-7 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm">                {index + 1}              </div>              <p className="text-gray-700 text-sm flex-1">{rec}</p>            </div>          ))}        </div>      )}      <p className="text-xs text-gray-500 mt-4 text-center">        {language === 'ja'           ? `生成日時: ${new Date(recommendations.generatedAt).toLocaleString('ja-JP')}`          : `Tạo lúc: ${new Date(recommendations.generatedAt).toLocaleString('vi-VN')}`}      </p>    </div>  );};export default AIRecommendations;