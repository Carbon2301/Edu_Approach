const API_BASE_URL = 'http://localhost:5000/api';const BACKEND_BASE_URL = 'http://localhost:5000';const getTabId = (): string => {  let tabId = sessionStorage.getItem('tabId');  if (!tabId) {    tabId = `tab_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;    sessionStorage.setItem('tabId', tabId);  }  return tabId;};const getStorageKey = (key: string): string => {  return `${key}_${getTabId()}`;};export const storage = {  getItem: (key: string): string | null => {    return sessionStorage.getItem(getStorageKey(key));  },  setItem: (key: string, value: string): void => {    sessionStorage.setItem(getStorageKey(key), value);  },  removeItem: (key: string): void => {    sessionStorage.removeItem(getStorageKey(key));  },};export const getImageUrl = (imagePath: string | null | undefined): string | null => {  if (!imagePath) return null;  if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {    return imagePath;  }  if (imagePath.startsWith('/')) {    return `${BACKEND_BASE_URL}${imagePath}`;  }  return `${BACKEND_BASE_URL}/${imagePath}`;};interface RegisterData {  email: string;  password: string;  name: string;  role: 'student' | 'teacher';  studentId?: string;  selfIntro?: string;  gender?: 'male' | 'female' | 'other';  profileImage?: File;}interface LoginData {  email: string;  password: string;}interface ApiResponse<T> {  success: boolean;  message?: string;  data?: T;  errors?: any[];}class ApiService {  async register(data: RegisterData): Promise<ApiResponse<any>> {    try {      const formData = new FormData();      formData.append('email', data.email);      formData.append('password', data.password);      formData.append('name', data.name);      formData.append('role', data.role);      if (data.studentId) formData.append('studentId', data.studentId);      if (data.selfIntro) formData.append('selfIntro', data.selfIntro);      if (data.gender) formData.append('gender', data.gender);      if (data.profileImage) formData.append('profileImage', data.profileImage);      const response = await fetch(`${API_BASE_URL}/auth/register`, {        method: 'POST',        body: formData,      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Registration failed');      }      if (result.data?.token) {        storage.setItem('token', result.data.token);        storage.setItem('user', JSON.stringify(result.data.user));      }      return result;    } catch (error: any) {      console.error('Register error:', error);      return {        success: false,        message: error.message || 'Registration failed',      };    }  }  async login(data: LoginData): Promise<ApiResponse<any>> {    try {      const response = await fetch(`${API_BASE_URL}/auth/login`, {        method: 'POST',        headers: {          'Content-Type': 'application/json',        },        body: JSON.stringify(data),      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Login failed');      }      if (result.data?.token) {        storage.setItem('token', result.data.token);        storage.setItem('user', JSON.stringify(result.data.user));      }      return result;    } catch (error: any) {      console.error('Login error:', error);      return {        success: false,        message: error.message || 'Login failed',      };    }  }  async getCurrentUser(): Promise<ApiResponse<any>> {    try {      const token = storage.getItem('token');      if (!token) {        throw new Error('No token found');      }      const response = await fetch(`${API_BASE_URL}/auth/me`, {        headers: {          'Authorization': `Bearer ${token}`,        },      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Failed to get user');      }      if (result.data?.user?.profileImage) {        result.data.user.profileImage = getImageUrl(result.data.user.profileImage);      }      if (result.data?.user) {        storage.setItem('user', JSON.stringify(result.data.user));      }      return result;    } catch (error: any) {      console.error('Get user error:', error);      return {        success: false,        message: error.message || 'Failed to get user',      };    }  }  logout() {    storage.removeItem('token');    storage.removeItem('user');  }  isAuthenticated(): boolean {    return !!storage.getItem('token');  }  getStoredUser() {    const userStr = storage.getItem('user');    return userStr ? JSON.parse(userStr) : null;  }  async updateProfile(data: {    name?: string;    location?: string;    studentId?: string;    selfIntro?: string;    gender?: 'male' | 'female' | 'other';    profileImage?: File | null;  }): Promise<ApiResponse<any>> {    try {      const token = storage.getItem('token');      if (!token) {        throw new Error('No token found');      }      const formData = new FormData();      if (data.name) formData.append('name', data.name);      if (data.location !== undefined) formData.append('location', data.location);      if (data.studentId !== undefined) formData.append('studentId', data.studentId);      if (data.selfIntro !== undefined) formData.append('selfIntro', data.selfIntro);      if (data.gender !== undefined) formData.append('gender', data.gender || '');      if (data.profileImage) {        formData.append('profileImage', data.profileImage);      }      const response = await fetch(`${API_BASE_URL}/users/profile`, {        method: 'PUT',        headers: {          'Authorization': `Bearer ${token}`,        },        body: formData,      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Failed to update profile');      }      if (result.data?.user) {        if (result.data.user.profileImage) {          result.data.user.profileImage = getImageUrl(result.data.user.profileImage);        }        storage.setItem('user', JSON.stringify(result.data.user));      }      return result;    } catch (error: any) {      console.error('Update profile error:', error);      return {        success: false,        message: error.message || 'Failed to update profile',      };    }  }  async deleteProfileImage(): Promise<ApiResponse<any>> {    try {      const token = storage.getItem('token');      if (!token) {        throw new Error('No token found');      }      const response = await fetch(`${API_BASE_URL}/users/profile/image`, {        method: 'DELETE',        headers: {          'Authorization': `Bearer ${token}`,        },      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Failed to delete profile image');      }      if (result.data?.user) {        storage.setItem('user', JSON.stringify(result.data.user));      }      return result;    } catch (error: any) {      console.error('Delete profile image error:', error);      return {        success: false,        message: error.message || 'Failed to delete profile image',      };    }  }  async completeGoogleRegistration(data: {    role: 'student' | 'teacher';    name: string;    gender: 'male' | 'female' | 'other';    studentId?: string;    selfIntro?: string;  }): Promise<ApiResponse<any>> {    try {      const response = await fetch(`${API_BASE_URL}/auth/google/complete`, {        method: 'POST',        headers: {          'Content-Type': 'application/json',        },        credentials: 'include', 
        body: JSON.stringify(data),      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Failed to complete registration');      }      if (result.data?.token) {        storage.setItem('token', result.data.token);        storage.setItem('user', JSON.stringify(result.data.user));      }      return result;    } catch (error: any) {      console.error('Complete Google registration error:', error);      return {        success: false,        message: error.message || 'Failed to complete registration',      };    }  }  async getStudentDashboard(): Promise<ApiResponse<any>> {    try {      const token = storage.getItem('token');      if (!token) {        throw new Error('No token found');      }      const response = await fetch(`${API_BASE_URL}/users/student/dashboard`, {        headers: {          'Authorization': `Bearer ${token}`,        },      });      const result = await response.json();      if (!response.ok) {        throw new Error(result.message || 'Failed to get student dashboard');      }      return result;    } catch (error: any) {      console.error('Get student dashboard error:', error);      return {        success: false,        message: error.message || 'Failed to get student dashboard',      };    }  }}export const api = new ApiService();export type { RegisterData, LoginData, ApiResponse };