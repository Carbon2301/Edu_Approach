import multer from 'multer';import path from 'path';import { fileURLToPath } from 'url';import { dirname, join } from 'path';const __filename = fileURLToPath(import.meta.url);const __dirname = dirname(__filename);const backendRoot = join(__dirname, '..', '..');const uploadsPath = join(backendRoot, 'uploads');const storage = multer.diskStorage({  destination: (req, file, cb) => {    cb(null, uploadsPath);  },  filename: (req, file, cb) => {    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1e9);    cb(null, 'profile-' + uniqueSuffix + path.extname(file.originalname));  },});const fileFilter = (req, file, cb) => {  if (!file.mimetype.startsWith('image/')) {    cb(new Error('Only image files are allowed'), false);    return;  }  cb(null, true);};const upload = multer({  storage: storage,  limits: {    fileSize: parseInt(process.env.MAX_FILE_SIZE) || 5 * 1024 * 1024, 
  },  fileFilter: fileFilter,});export const uploadProfileImage = upload.single('profileImage');export const handleUploadError = (err, req, res, next) => {  if (err instanceof multer.MulterError) {    if (err.code === 'LIMIT_FILE_SIZE') {      return res.status(400).json({        success: false,        message: 'File size is too large. Maximum size is 5MB',      });    }    return res.status(400).json({      success: false,      message: err.message,    });  } else if (err) {    return res.status(400).json({      success: false,      message: err.message,    });  }  next();};