import {  generateStudentRecommendations,  generateTeachingRecommendations as generateTeachingRecs,  generateClassTeachingRecommendations as generateClassTeachingRecs} from './localRecommendations.js';class AIServiceGemini {  constructor() {    this.modelName = 'local-recommendations';  }  async generateRecommendations(studentData) {    const { name, oceanResult, logicalResult, language = 'ja', mode = 'combined' } = studentData;    try {      const result = generateStudentRecommendations({        oceanResult,        logicalResult,        language,        mode,      });      return result;    } catch (error) {      console.error('âŒ Generate recommendations error:', error);      return {        success: false,        recommendations: language === 'ja'           ? ['å­¦ç¿’è¨ˆç”»ã‚’ç«‹ã¦ã€æ¯æ—¥å°‘ã—ãšã¤é€²ã‚ã¾ã—ã‚‡ã†ã€‚', 'å®šæœŸçš„ã«å¾©ç¿’ã™ã‚‹ã“ã¨ã§ã€çŸ¥è­˜ã‚’å®šç€ã•ã›ã‚‰ã‚Œã¾ã™ã€‚', 'è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ç„¡ç†ãªãå­¦ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚']          : ['Láº­p káº¿ hoáº¡ch há»c táº­p vÃ  tiáº¿n bá»™ tá»«ng chÃºt má»™t má»—i ngÃ y.', 'Ã”n táº­p Ä‘á»‹nh ká»³ Ä‘á»ƒ cá»§ng cá»‘ kiáº¿n thá»©c.', 'Tiáº¿p tá»¥c há»c theo nhá»‹p Ä‘á»™ cá»§a mÃ¬nh má»™t cÃ¡ch thoáº£i mÃ¡i.'],        rawResponse: null,        error: error.message,      };    }  }  extractAdditionalRecommendations(aiResponse, existingRecs) {    const cleanResponse = aiResponse.replace(/\*\*(.*?)\*\*/g, '$1');    const lines = cleanResponse.split('\n');    const found = new Set(existingRecs.map(r => r.substring(0, 50))); 
    const additional = [];    let currentRec = '';    let currentNumber = null;    for (let i = 0; i < lines.length; i++) {      const line = lines[i].trim();      if (!line) continue;      const numberMatch = line.match(/^(\d+)[\.\)ã€]\s+(.+)/);      if (numberMatch) {        const num = parseInt(numberMatch[1]);        const content = numberMatch[2].trim();        const key = content.substring(0, 50);        if (!found.has(key) && content.length > 30) {          if (currentRec && currentNumber !== null) {            additional.push(currentRec.trim());          }          currentNumber = num;          currentRec = content;          found.add(key);        }      } else if (currentRec && currentNumber !== null) {        currentRec += ' ' + line;      }    }    if (currentRec && currentNumber !== null) {      additional.push(currentRec.trim());    }    return additional.filter(r => r.length > 30).slice(0, 3 - existingRecs.length);  }  parseRecommendations(aiResponse) {    if (!aiResponse) return [];    const cleanResponse = aiResponse.replace(/\*\*(.*?)\*\*/g, '$1');    const lines = cleanResponse.split('\n');    const recommendations = [];    let currentRec = '';    let currentNumber = null;    for (let i = 0; i < lines.length; i++) {      const line = lines[i];      const trimmed = line.trim();      if (!trimmed) {        if (currentRec && currentNumber !== null) {          const nextNonEmpty = lines.slice(i + 1).find(l => l.trim());          if (nextNonEmpty && /^\d+[\.\)ã€]\s/.test(nextNonEmpty.trim())) {            recommendations.push(currentRec.trim());            currentRec = '';            currentNumber = null;          }        }        continue;      }      const numberMatch = trimmed.match(/^(\d+)[\.\)ã€]\s+(.+)/);      if (numberMatch) {        const num = parseInt(numberMatch[1]);        let content = numberMatch[2].trim();        content = content.replace(/\*\*([^*]+)\*\*/g, '$1');        if (currentRec && currentNumber !== null) {          recommendations.push(currentRec.trim());        }        currentNumber = num;        currentRec = content;      } else if (currentRec && currentNumber !== null) {        const isNewSection = /^[A-ZÃÃ€áº¢Ãƒáº Ä‚áº®áº°áº²áº´áº¶Ã‚áº¤áº¦áº¨áºªáº¬Ã‰Ãˆáººáº¼áº¸ÃŠáº¾á»€á»‚á»„á»†ÃÃŒá»ˆÄ¨á»ŠÃ“Ã’á»Ã•á»ŒÃ”á»á»’á»”á»–á»˜Æ á»šá»œá»á» á»¢ÃšÃ™á»¦Å¨á»¤Æ¯á»¨á»ªá»¬á»®á»°Ãá»²á»¶á»¸á»´Ä][^.!?]*:$/.test(trimmed);        if (!isNewSection) {          const nextNonEmpty = lines.slice(i + 1).find(l => l.trim());          if (nextNonEmpty && /^\d+[\.\)ã€]\s/.test(nextNonEmpty.trim())) {            currentRec += ' ' + trimmed;            recommendations.push(currentRec.trim());            currentRec = '';            currentNumber = null;          } else {            currentRec += ' ' + trimmed;          }        } else {          if (currentRec.trim().length > 30) {            recommendations.push(currentRec.trim());          }          currentRec = '';          currentNumber = null;        }      }    }    if (currentRec && currentNumber !== null && currentRec.trim().length > 30) {      recommendations.push(currentRec.trim());    }    const filtered = recommendations      .map(rec => rec.trim())      .filter(rec => {        if (rec.length < 30) return false;        if (/^[A-ZÃÃ€áº¢Ãƒáº Ä‚áº®áº°áº²áº´áº¶Ã‚áº¤áº¦áº¨áºªáº¬Ã‰Ãˆáººáº¼áº¸ÃŠáº¾á»€á»‚á»„á»†ÃÃŒá»ˆÄ¨á»ŠÃ“Ã’á»Ã•á»ŒÃ”á»á»’á»”á»–á»˜Æ á»šá»œá»á» á»¢ÃšÃ™á»¦Å¨á»¤Æ¯á»¨á»ªá»¬á»®á»°Ãá»²á»¶á»¸á»´Ä][^.!?]*:$/.test(rec)) return false;        if (/^(ChÃ o|Xin chÃ o|ChÃºc|KÃ­nh chÃ o|TrÃ¢n trá»ng|Vá»›i káº¿t quáº£)/i.test(rec)) return false;        if (/^ChÃ o báº¡n,?\s*$/i.test(rec)) return false;        return true;      });    if (filtered.length >= 5) {      return filtered;    }    if (filtered.length === 0 && aiResponse.length > 100) {      const emergencySplit = aiResponse.match(/\d+[\.\)ã€]\s*[^\d]+/g);      if (emergencySplit && emergencySplit.length > 0) {        const emergencyRecs = emergencySplit          .map(s => s.replace(/^\d+[\.\)ã€]\s*/, '').trim())          .filter(s => s.length > 30)          .slice(0, 3);        if (emergencyRecs.length > 0) {          return emergencyRecs;        }      }      const doubleNewlineSplit = aiResponse.split(/\n\s*\n/).filter(s => {        const trimmed = s.trim();        return trimmed.length > 50 && /^\d+[\.\)ã€]/.test(trimmed);      });      if (doubleNewlineSplit.length > 0) {        const recs = doubleNewlineSplit          .map(s => s.replace(/^\d+[\.\)ã€]\s*/, '').trim())          .filter(s => s.length > 30)          .slice(0, 3);        if (recs.length > 0) {          return recs;        }      }      console.error('âŒ All parsing methods failed! Raw response length:', aiResponse.length);      console.error('   First 300 chars:', aiResponse.substring(0, 300));    }    return filtered.length > 0 ? filtered : [];  }  buildPrompt(data) {    const { name, oceanResult, logicalResult, language, mode = 'combined' } = data;    let systemPrompt = language === 'ja'      ? 'ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªæ•™è‚²å¿ƒç†å­¦è€…ã§å­¦ç¿’ã‚³ãƒ¼ãƒã§ã™ã€‚å­¦ç”Ÿã®æ€§æ ¼è¨ºæ–­ã¨ãƒ†ã‚¹ãƒˆçµæœã‚’æ·±ãåˆ†æã—ã€å…·ä½“çš„ã§å®Ÿè·µçš„ãªå­¦ç¿’æˆ¦ç•¥ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚å„æ¨å¥¨ã¯è©³ç´°ã§ã€å®Ÿè¡Œæ–¹æ³•ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã€å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n'      : 'Báº¡n lÃ  nhÃ  tÃ¢m lÃ½ giÃ¡o dá»¥c vÃ  huáº¥n luyá»‡n viÃªn há»c táº­p giÃ u kinh nghiá»‡m. HÃ£y phÃ¢n tÃ­ch sÃ¢u káº¿t quáº£ kiá»ƒm tra vÃ  Ä‘Æ°a ra chiáº¿n lÆ°á»£c há»c táº­p cá»¥ thá»ƒ, thá»±c táº¿. Má»—i gá»£i Ã½ pháº£i chi tiáº¿t vá»›i cÃ¡ch thá»±c hiá»‡n, hiá»‡u quáº£ mong Ä‘á»£i, vÃ  tÃ i nguyÃªn cáº§n thiáº¿t.\n\n';    if (language === 'ja') {      let prompt = systemPrompt + `å­¦ç”Ÿå: ${name}\n\n`;      if (oceanResult && oceanResult.scores) {        prompt += `OCEANæ€§æ ¼è¨ºæ–­çµæœ:\n`;        prompt += `- ç¥çµŒç—‡å‚¾å‘: ${oceanResult.scores.neuroticism}%\n`;        prompt += `- å¤–å‘æ€§: ${oceanResult.scores.extraversion}%\n`;        prompt += `- é–‹æ”¾æ€§: ${oceanResult.scores.openness}%\n`;        prompt += `- å”èª¿æ€§: ${oceanResult.scores.agreeableness}%\n`;        prompt += `- èª å®Ÿæ€§: ${oceanResult.scores.conscientiousness}%\n`;        prompt += `å„ªä½ãªç‰¹æ€§: ${oceanResult.dominantTrait}\n\n`;      }      if (logicalResult) {        prompt += `è«–ç†çš„æ¨è«–ãƒ†ã‚¹ãƒˆçµæœ:\n`;        prompt += `- æ­£è§£ç‡: ${logicalResult.percentage}%\n`;        prompt += `- æ­£è§£æ•°: ${logicalResult.correctCount}/${logicalResult.totalQuestions}\n\n`;      }      if (mode === 'ocean_only') {        prompt += `ä¸Šè¨˜ã®OCEANæ€§æ ¼è¨ºæ–­çµæœã®ã¿ã«åŸºã¥ã„ã¦:\n`;        prompt += `1. ã“ã®æ€§æ ¼ç‰¹æ€§ã«æœ€é©ãªå­¦ç¿’ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’3å€‹ææ¡ˆã—ã¦ãã ã•ã„\n`;        prompt += `2. å„ææ¡ˆã¯3-4æ–‡ã§ã€å…·ä½“çš„ãªå®Ÿè·µæ–¹æ³•ã€å®Ÿè¡Œæ‰‹é †ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã€å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’å«ã‚ã¦ãã ã•ã„\n`;        prompt += `3. å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã€ç’°å¢ƒè¨­å®šã€æ™‚é–“ç®¡ç†ã€å¯¾äººé–¢ä¿‚ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒã€è¨˜æ†¶è¡“ã€å¾©ç¿’æ–¹æ³•ãªã©å¤šæ§˜ãªå´é¢ã‚’ã‚«ãƒãƒ¼\n`;        prompt += `4. å„æ¨å¥¨ã«ã¯å…·ä½“çš„ãªä¾‹ã€ã‚¢ãƒ—ãƒªåã€ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã€æ™‚é–“é…åˆ†ã€é »åº¦ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„\n`;      } else if (mode === 'logical_only') {        prompt += `ä¸Šè¨˜ã®è«–ç†çš„æ¨è«–ãƒ†ã‚¹ãƒˆçµæœ(${logicalResult.percentage}%)ã®ã¿ã«åŸºã¥ã„ã¦:\n`;        prompt += `1. ã“ã®æˆç¸¾ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸå…·ä½“çš„ãªæ”¹å–„æ–¹æ³•ã‚’3å€‹ææ¡ˆã—ã¦ãã ã•ã„\n`;        prompt += `2. å„ææ¡ˆã¯3-4æ–‡ã§ã€ç·´ç¿’æ–¹æ³•ã€ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã€æœŸå¾…åŠ¹æœã€æ™‚é–“é…åˆ†ã€é »åº¦ã‚’å«ã‚€\n`;        prompt += `3. å…·ä½“çš„ãªã‚¢ãƒ—ãƒªåã€ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆURLã€æ•™æåã€ç·´ç¿’å•é¡Œã®ç¨®é¡ã‚’æ¨å¥¨ã—ã¦ãã ã•ã„\n`;        prompt += `4. æ®µéšçš„ãªå­¦ç¿’è¨ˆç”»ï¼ˆåˆç´šâ†’ä¸­ç´šâ†’ä¸Šç´šï¼‰ã‚’å«ã‚ã¦ãã ã•ã„\n`;      } else {        prompt += `OCEANæ€§æ ¼è¨ºæ–­ã¨è«–ç†ãƒ†ã‚¹ãƒˆã®ä¸¡æ–¹ã«åŸºã¥ã„ã¦:\n`;        prompt += `1. ç·åˆçš„ãªå­¦ç¿’æˆ¦ç•¥ã‚’3å€‹ææ¡ˆã—ã¦ãã ã•ã„ï¼ˆå„3-4æ–‡ã§è©³ç´°ã«ï¼‰\n`;        prompt += `2. æ€§æ ¼ç‰¹æ€§ã¨è«–ç†èƒ½åŠ›ã‚’çµ„ã¿åˆã‚ã›ãŸå€‹åˆ¥åŒ–ã•ã‚ŒãŸæ–¹æ³•ã‚’ææ¡ˆ\n`;        prompt += `3. å„æ¨å¥¨ã«ã¯: å…·ä½“çš„ãªè¡Œå‹•ã€æ™‚é–“é…åˆ†ã€é »åº¦ã€ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã€æœŸå¾…åŠ¹æœã€å®Ÿè·µä¾‹ã‚’å«ã‚ã¦ãã ã•ã„\n`;        prompt += `4. å­¦ç¿’ç’°å¢ƒã€æ™‚é–“ç®¡ç†ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€è¨˜æ†¶è¡“ã€å•é¡Œè§£æ±ºã‚¹ã‚­ãƒ«ã€å®Ÿè·µæ–¹æ³•ãªã©å¤šè§’çš„ã«ã‚«ãƒãƒ¼\n`;      }      prompt += `\nğŸ”´é‡è¦: å„æ¨å¥¨ã¯å¿…ãš3-4æ–‡ã§è©³ç´°ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚å…·ä½“çš„ãªè¡Œå‹•ã€æ™‚é–“ï¼ˆä¾‹: æ¯æ—¥30åˆ†ã€é€±3å›ï¼‰ã€ãƒ„ãƒ¼ãƒ«ï¼ˆã‚¢ãƒ—ãƒªåã€URLï¼‰ã€æœŸå¾…åŠ¹æœã€å®Ÿè·µä¾‹ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚\n`;      prompt += `ğŸ”´å½¢å¼: å„æ¨å¥¨ã¯å¿…ãšç•ªå·ä»˜ããƒªã‚¹ãƒˆã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n`;      prompt += `ä¾‹:\n`;      prompt += `1. [æ¨å¥¨å†…å®¹1 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `2. [æ¨å¥¨å†…å®¹2 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `3. [æ¨å¥¨å†…å®¹3 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `å¿…ãš3å€‹ã®æ¨å¥¨ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚å„æ¨å¥¨ã¯ç‹¬ç«‹ã—ãŸè¡Œã§ã€ç•ªå·ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n`;      return prompt;    } else {      let prompt = systemPrompt + `TÃªn há»c sinh: ${name}\n\n`;      if (oceanResult && oceanResult.scores) {        prompt += `Káº¿t quáº£ OCEAN:\n`;        prompt += `- Xu hÆ°á»›ng tháº§n kinh: ${oceanResult.scores.neuroticism}%\n`;        prompt += `- HÆ°á»›ng ngoáº¡i: ${oceanResult.scores.extraversion}%\n`;        prompt += `- Cá»Ÿi má»Ÿ: ${oceanResult.scores.openness}%\n`;        prompt += `- Dá»… chá»‹u: ${oceanResult.scores.agreeableness}%\n`;        prompt += `- Táº­n tÃ¢m: ${oceanResult.scores.conscientiousness}%\n`;        prompt += `Äáº·c Ä‘iá»ƒm ná»•i báº­t: ${oceanResult.dominantTrait}\n\n`;      }      if (logicalResult) {        prompt += `Káº¿t quáº£ Logical:\n`;        prompt += `- Tá»· lá»‡: ${logicalResult.percentage}%\n`;        prompt += `- ÄÃºng: ${logicalResult.correctCount}/${logicalResult.totalQuestions}\n\n`;      }      if (mode === 'ocean_only') {        prompt += `Chá»‰ dá»±a trÃªn OCEAN:\n`;        prompt += `1. Äá» xuáº¥t 3 phÆ°Æ¡ng phÃ¡p há»c chi tiáº¿t (má»—i gá»£i Ã½ 3-4 cÃ¢u)\n`;        prompt += `2. Bao gá»“m: hÃ nh Ä‘á»™ng cá»¥ thá»ƒ, thá»i gian (vÃ­ dá»¥: má»—i ngÃ y 30 phÃºt, tuáº§n 3 láº§n), cÃ´ng cá»¥ (tÃªn app, URL), káº¿t quáº£ mong Ä‘á»£i\n`;        prompt += `3. Bao gá»“m: phong cÃ¡ch há»c, mÃ´i trÆ°á»ng, quáº£n lÃ½ thá»i gian, quan há»‡ xÃ£ há»™i, Ä‘á»™ng lá»±c, ká»¹ thuáº­t ghi nhá»›, phÆ°Æ¡ng phÃ¡p Ã´n táº­p\n`;        prompt += `4. Má»—i gá»£i Ã½ pháº£i cÃ³ vÃ­ dá»¥ cá»¥ thá»ƒ, tÃªn app, website, thá»i gian, táº§n suáº¥t thá»±c hiá»‡n\n`;      } else if (mode === 'logical_only') {        prompt += `Chá»‰ dá»±a trÃªn Logic (${logicalResult.percentage}%):\n`;        prompt += `1. Äá» xuáº¥t 3 cÃ¡ch cáº£i thiá»‡n chi tiáº¿t (má»—i gá»£i Ã½ 3-4 cÃ¢u)\n`;        prompt += `2. Gá»£i Ã½ app cá»¥ thá»ƒ (tÃªn app), website (URL), sÃ¡ch, loáº¡i bÃ i táº­p\n`;        prompt += `3. Bao gá»“m lá»™ trÃ¬nh há»c tá»«ng bÆ°á»›c (cÆ¡ báº£n â†’ trung bÃ¬nh â†’ nÃ¢ng cao)\n`;        prompt += `4. Má»—i gá»£i Ã½ pháº£i cÃ³: phÆ°Æ¡ng phÃ¡p luyá»‡n táº­p, cÃ´ng cá»¥, thá»i gian, táº§n suáº¥t, káº¿t quáº£ mong Ä‘á»£i\n`;      } else {        prompt += `Dá»±a trÃªn Cáº¢ HAI:\n`;        prompt += `1. 3 chiáº¿n lÆ°á»£c tá»•ng há»£p chi tiáº¿t (má»—i gá»£i Ã½ 3-4 cÃ¢u)\n`;        prompt += `2. Káº¿t há»£p tÃ­nh cÃ¡ch vÃ  logic, cÃ¡ nhÃ¢n hÃ³a hoÃ n toÃ n\n`;        prompt += `3. Má»—i gá»£i Ã½ pháº£i cÃ³: hÃ nh Ä‘á»™ng cá»¥ thá»ƒ, thá»i gian (vÃ­ dá»¥: má»—i ngÃ y 30 phÃºt), táº§n suáº¥t, cÃ´ng cá»¥ (tÃªn app, URL), káº¿t quáº£ mong Ä‘á»£i, vÃ­ dá»¥ thá»±c táº¿\n`;        prompt += `4. Bao gá»“m: mÃ´i trÆ°á»ng há»c, quáº£n lÃ½ thá»i gian, Ä‘á»™ng lá»±c, ká»¹ thuáº­t ghi nhá»›, ká»¹ nÄƒng giáº£i quyáº¿t váº¥n Ä‘á», phÆ°Æ¡ng phÃ¡p thá»±c hÃ nh\n`;      }      prompt += `\nğŸ”´QUAN TRá»ŒNG: Má»—i gá»£i Ã½ PHáº¢I 3-4 cÃ¢u vá»›i CÃCH LÃ€M, THá»œI GIAN (vÃ­ dá»¥: má»—i ngÃ y 30 phÃºt, tuáº§n 3 láº§n), CÃ”NG Cá»¤ (tÃªn app, URL cá»¥ thá»ƒ), Káº¾T QUáº¢, VÃ Dá»¤ thá»±c táº¿!\n`;      prompt += `ğŸ”´Äá»‹nh dáº¡ng: Má»—i gá»£i Ã½ pháº£i lÃ  danh sÃ¡ch cÃ³ sá»‘ thá»© tá»±, má»—i gá»£i Ã½ trÃªn 1 dÃ²ng riÃªng:\n`;      prompt += `VÃ­ dá»¥:\n`;      prompt += `1. [Ná»™i dung gá»£i Ã½ 1 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `2. [Ná»™i dung gá»£i Ã½ 2 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `3. [Ná»™i dung gá»£i Ã½ 3 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `Báº®T BUá»˜C pháº£i cÃ³ 3 gá»£i Ã½. Má»—i gá»£i Ã½ pháº£i báº¯t Ä‘áº§u báº±ng sá»‘ thá»© tá»± (1. 2. 3.) vÃ  náº±m trÃªn dÃ²ng riÃªng.\n`;      return prompt;    }  }  getFallbackRecommendations(data) {    const { language, oceanResult, logicalResult, mode } = data;    const recommendations = [];    if (language === 'ja') {      if (mode === 'ocean_only' && oceanResult) {        recommendations.push('è¨ˆç”»çš„ãªå­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€æ¯é€±æ—¥æ›œæ—¥ã«æ¬¡é€±ã®äºˆå®šã‚’ç«‹ã¦ã‚‹ã“ã¨ã§ã€åŠ¹ç‡çš„ã«æ™‚é–“ã‚’ä½¿ãˆã¾ã™ã€‚Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚„ãƒˆãƒ¬ãƒ­ã‚’æ´»ç”¨ã—ã€æ¯æ—¥ã®å­¦ç¿’æ™‚é–“ã‚’30åˆ†ã‹ã‚‰1æ™‚é–“ç¢ºä¿ã—ã¾ã—ã‚‡ã†ã€‚å®šæœŸçš„ãªè¦‹ç›´ã—ã§é€²æ—ã‚’ç¢ºèªã§ãã¾ã™ã€‚');        recommendations.push('æ€§æ ¼ã«åˆã£ãŸå­¦ç¿’ç’°å¢ƒã‚’æ•´ãˆã€é›†ä¸­ã§ãã‚‹æ™‚é–“å¸¯(æœå‹/å¤œå‹)ã‚’è¦‹æ¥µã‚ã¦ã€ãã®æ™‚é–“ã«é‡è¦ãªå‹‰å¼·ã‚’é…ç½®ã—ã¾ã—ã‚‡ã†ã€‚é™ã‹ãªå›³æ›¸é¤¨ã‚„ã‚«ãƒ•ã‚§ãªã©ã€è‡ªåˆ†ã«æœ€é©ãªå ´æ‰€ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚');        recommendations.push('ã‚°ãƒ«ãƒ¼ãƒ—å­¦ç¿’ã‚„ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ã€é€±ã«2-3å›ã¯ä»²é–“ã¨ä¸€ç·’ã«å‹‰å¼·ã™ã‚‹ã“ã¨ã§ã€ç†è§£ã‚’æ·±ã‚ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã§ãã¾ã™ã€‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«ã‚‚å‚åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚');      } else if (mode === 'logical_only' && logicalResult) {        const p = logicalResult.percentage;        if (p >= 80) {          recommendations.push('å„ªã‚ŒãŸè«–ç†åŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚AtCoderã‚„Codeforcesã§é€±1-2å›ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã«å‚åŠ ã—ã€å®Ÿè·µçš„ãªå•é¡Œè§£æ±ºåŠ›ã‚’ç£¨ãã¾ã—ã‚‡ã†ã€‚é›£æ˜“åº¦ã®é«˜ã„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å•é¡Œã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ã«ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã‚‰ã‚Œã¾ã™ã€‚');          recommendations.push('LeetCodeã‚„Project Eulerã§æ¯æ—¥1-2å•ã®é«˜åº¦ãªå•é¡Œã‚’è§£ãã“ã¨ã§ã€è«–ç†çš„æ€è€ƒåŠ›ã‚’ç¶­æŒãƒ»å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚ç‰¹ã«å‹•çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚„ã‚°ãƒ©ãƒ•ç†è«–ã®å•é¡Œã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚');          recommendations.push('æ•°å­¦çš„ãƒ‘ã‚ºãƒ«ã‚„è«–ç†ã‚²ãƒ¼ãƒ ï¼ˆæ•°ç‹¬ã€ãƒã‚§ã‚¹ã€å›²ç¢ãªã©ï¼‰ã‚’é€±ã«3-4å›æ¥½ã—ã‚€ã“ã¨ã§ã€ãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜èƒ½åŠ›ã¨æˆ¦ç•¥çš„æ€è€ƒã‚’é¤Šãˆã¾ã™ã€‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚‚æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚');        } else if (p >= 60) {          recommendations.push('æ¯æ—¥15åˆ†ã€Brilliant.orgã§è«–ç†ãƒ‘ã‚ºãƒ«ã‚’è§£ãã“ã¨ã‹ã‚‰å§‹ã‚ã€2é€±é–“å¾Œã«é›£æ˜“åº¦ã‚’ä¸Šã’ã¦ã„ãã¾ã—ã‚‡ã†ã€‚é€²æ—ã‚’ãƒãƒ¼ãƒˆã«è¨˜éŒ²ã™ã‚‹ã¨åŠ¹æœçš„ã§ã™ã€‚é€±ã«1å›ã¯å¾©ç¿’ã—ã¦ã€ç†è§£ã‚’æ·±ã‚ã¾ã—ã‚‡ã†ã€‚');          recommendations.push('æ•°ç‹¬ã‚„ã‚¯ãƒ­ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ‘ã‚ºãƒ«ã‚’æ¯æ—¥10-15åˆ†å–ã‚Šçµ„ã‚€ã“ã¨ã§ã€åŸºç¤çš„ãªè«–ç†çš„æ€è€ƒåŠ›ã‚’å¼·åŒ–ã§ãã¾ã™ã€‚å¾ã€…ã«é›£æ˜“åº¦ã‚’ä¸Šã’ã€ãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜èƒ½åŠ›ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚');          recommendations.push('ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºç¤å•é¡Œï¼ˆHackerRankã€Codewarsãªã©ï¼‰ã‚’é€±ã«3-4å›è§£ãã“ã¨ã§ã€è«–ç†çš„æ€è€ƒã‚’å®Ÿè·µçš„ã«å¿œç”¨ã§ãã¾ã™ã€‚ç°¡å˜ãªå•é¡Œã‹ã‚‰å§‹ã‚ã¦ã€æ®µéšçš„ã«é›£æ˜“åº¦ã‚’ä¸Šã’ã¦ã„ãã¾ã—ã‚‡ã†ã€‚');        } else {          recommendations.push('æ¯æ—¥15åˆ†ã€Brilliant.orgã§è«–ç†ãƒ‘ã‚ºãƒ«ã‚’è§£ãã“ã¨ã‹ã‚‰å§‹ã‚ã€2é€±é–“å¾Œã«é›£æ˜“åº¦ã‚’ä¸Šã’ã¦ã„ãã¾ã—ã‚‡ã†ã€‚é€²æ—ã‚’ãƒãƒ¼ãƒˆã«è¨˜éŒ²ã™ã‚‹ã¨åŠ¹æœçš„ã§ã™ã€‚ç°¡å˜ãªå•é¡Œã‹ã‚‰å§‹ã‚ã¦ã€è‡ªä¿¡ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚');          recommendations.push('æ•°ç‹¬ã®ç°¡å˜ãªå•é¡Œã‚’æ¯æ—¥10åˆ†å–ã‚Šçµ„ã‚€ã“ã¨ã§ã€åŸºç¤çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜èƒ½åŠ›ã‚’é¤Šãˆã¾ã™ã€‚2é€±é–“ç¶šã‘ãŸã‚‰ã€ä¸­ç´šãƒ¬ãƒ™ãƒ«ã«æŒ‘æˆ¦ã—ã€å¾ã€…ã«ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚');          recommendations.push('è«–ç†çš„æ€è€ƒã‚’é¤Šã†ãŸã‚ã«ã€æ—¥å¸¸çš„ãªå•é¡Œã‚’æ®µéšçš„ã«åˆ†æã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚ä¾‹ãˆã°ã€è²·ã„ç‰©ã®æœ€é©åŒ–ã‚„æ™‚é–“ç®¡ç†ãªã©ã€å®Ÿç”Ÿæ´»ã«å¿œç”¨ã§ãã‚‹å•é¡Œã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ãŒåŠ¹æœçš„ã§ã™ã€‚');        }      } else {        recommendations.push('è¨ˆç”»çš„ãªå­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€æ¯é€±æ—¥æ›œæ—¥ã«æ¬¡é€±ã®äºˆå®šã‚’ç«‹ã¦ã‚‹ã“ã¨ã§ã€åŠ¹ç‡çš„ã«æ™‚é–“ã‚’ä½¿ãˆã¾ã™ã€‚Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚„ãƒˆãƒ¬ãƒ­ã‚’æ´»ç”¨ã—ã€è«–ç†çš„æ€è€ƒã‚’é¤Šã†ãƒ‘ã‚ºãƒ«æ™‚é–“ã‚‚çµ„ã¿è¾¼ã¿ã¾ã—ã‚‡ã†ã€‚å®šæœŸçš„ãªè¦‹ç›´ã—ã§é€²æ—ã‚’ç¢ºèªã§ãã¾ã™ã€‚');        recommendations.push('æ€§æ ¼ã«åˆã£ãŸå­¦ç¿’ç’°å¢ƒã‚’æ•´ãˆã€é›†ä¸­ã§ãã‚‹æ™‚é–“å¸¯ã‚’è¦‹æ¥µã‚ã¦ã€ãã®æ™‚é–“ã«é‡è¦ãªå‹‰å¼·ã‚’é…ç½®ã—ã¾ã—ã‚‡ã†ã€‚è«–ç†ãƒ‘ã‚ºãƒ«ã¯æœã®é ­ãŒå†´ãˆã¦ã„ã‚‹æ™‚é–“ã«å–ã‚Šçµ„ã‚€ã¨åŠ¹æœçš„ã§ã™ã€‚é™ã‹ãªå›³æ›¸é¤¨ã‚„ã‚«ãƒ•ã‚§ãªã©ã€è‡ªåˆ†ã«æœ€é©ãªå ´æ‰€ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚');        recommendations.push('ã‚°ãƒ«ãƒ¼ãƒ—å­¦ç¿’ã‚„ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ã€é€±ã«2-3å›ã¯ä»²é–“ã¨ä¸€ç·’ã«å‹‰å¼·ã™ã‚‹ã“ã¨ã§ã€ç†è§£ã‚’æ·±ã‚ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã§ãã¾ã™ã€‚åŒæ™‚ã«ã€è«–ç†ãƒ‘ã‚ºãƒ«ã‚’ä¸€äººã§è§£ãæ™‚é–“ã‚‚ç¢ºä¿ã—ã€é›†ä¸­åŠ›ã‚’é«˜ã‚ã¾ã—ã‚‡ã†ã€‚');      }    } else {      if (mode === 'ocean_only' && oceanResult) {        recommendations.push('Táº¡o lá»‹ch há»c cÃ³ káº¿ hoáº¡ch, má»—i Chá»§ nháº­t láº­p káº¿ hoáº¡ch tuáº§n sau. Sá»­ dá»¥ng Google Calendar hoáº·c Trello Ä‘á»ƒ quáº£n lÃ½ thá»i gian hiá»‡u quáº£. Äáº£m báº£o má»—i ngÃ y dÃ nh 30 phÃºt Ä‘áº¿n 1 giá» cho viá»‡c há»c, vÃ  Ä‘á»‹nh ká»³ xem xÃ©t láº¡i tiáº¿n Ä‘á»™.');        recommendations.push('XÃ¡c Ä‘á»‹nh thá»i gian há»c tá»‘t nháº¥t (sÃ¡ng sá»›m/tá»‘i muá»™n) phÃ¹ há»£p vá»›i tÃ­nh cÃ¡ch, sáº¯p xáº¿p bÃ i khÃ³ vÃ o lÃºc Ä‘Ã³. TÃ¬m khÃ´ng gian yÃªn tÄ©nh nhÆ° thÆ° viá»‡n hoáº·c quÃ¡n cÃ  phÃª Ä‘á»ƒ táº­p trung tá»‘t hÆ¡n.');        recommendations.push('Tham gia há»c nhÃ³m hoáº·c tháº£o luáº­n 2-3 láº§n/tuáº§n Ä‘á»ƒ táº­n dá»¥ng tÃ­nh hÆ°á»›ng ngoáº¡i, giÃºp hiá»ƒu sÃ¢u hÆ¡n vÃ  duy trÃ¬ Ä‘á»™ng lá»±c. Tham gia cÃ¡c cá»™ng Ä‘á»“ng há»c táº­p trá»±c tuyáº¿n cÅ©ng ráº¥t há»¯u Ã­ch.');      } else if (mode === 'logical_only' && logicalResult) {        const p = logicalResult.percentage;        if (p >= 80) {          recommendations.push('Logic xuáº¥t sáº¯c! Tham gia contest trÃªn AtCoder hoáº·c Codeforces 1-2 láº§n/tuáº§n Ä‘á»ƒ rÃ¨n ká»¹ nÄƒng giáº£i quyáº¿t váº¥n Ä‘á» thá»±c táº¿. Thá»­ thÃ¡ch vá»›i cÃ¡c bÃ i toÃ¡n phá»©c táº¡p vá» thuáº­t toÃ¡n Ä‘á»ƒ nÃ¢ng cao trÃ¬nh Ä‘á»™.');          recommendations.push('Giáº£i 1-2 bÃ i toÃ¡n khÃ³ trÃªn LeetCode hoáº·c Project Euler má»—i ngÃ y Ä‘á»ƒ duy trÃ¬ vÃ  phÃ¡t triá»ƒn tÆ° duy logic. Táº­p trung vÃ o cÃ¡c chá»§ Ä‘á» nhÆ° dynamic programming vÃ  graph theory Ä‘á»ƒ má»Ÿ rá»™ng kiáº¿n thá»©c.');          recommendations.push('ChÆ¡i cÃ¡c trÃ² chÆ¡i logic nhÆ° Sudoku, cá» vua, cá» vÃ¢y 3-4 láº§n/tuáº§n Ä‘á»ƒ rÃ¨n luyá»‡n kháº£ nÄƒng nháº­n diá»‡n máº«u vÃ  tÆ° duy chiáº¿n lÆ°á»£c. Tham gia cÃ¡c ná»n táº£ng Ä‘áº¥u trá»±c tuyáº¿n Ä‘á»ƒ cáº£i thiá»‡n ká»¹ nÄƒng.');        } else if (p >= 60) {          recommendations.push('Má»—i ngÃ y 15 phÃºt giáº£i logic puzzle trÃªn Brilliant.org, sau 2 tuáº§n tÄƒng Ä‘á»™ khÃ³. Ghi chÃ©p tiáº¿n bá»™ Ä‘á»ƒ táº¡o Ä‘á»™ng lá»±c. Ã”n táº­p láº¡i má»—i tuáº§n má»™t láº§n Ä‘á»ƒ cá»§ng cá»‘ kiáº¿n thá»©c.');          recommendations.push('LÃ m Sudoku hoáº·c cÃ¢u Ä‘á»‘ Ã´ chá»¯ 10-15 phÃºt má»—i ngÃ y Ä‘á»ƒ cá»§ng cá»‘ tÆ° duy logic cÆ¡ báº£n. TÄƒng dáº§n Ä‘á»™ khÃ³ vÃ  rÃ¨n luyá»‡n kháº£ nÄƒng nháº­n diá»‡n máº«u má»™t cÃ¡ch cÃ³ há»‡ thá»‘ng.');          recommendations.push('Giáº£i cÃ¡c bÃ i toÃ¡n láº­p trÃ¬nh cÆ¡ báº£n trÃªn HackerRank hoáº·c Codewars 3-4 láº§n/tuáº§n Ä‘á»ƒ Ã¡p dá»¥ng tÆ° duy logic vÃ o thá»±c táº¿. Báº¯t Ä‘áº§u tá»« bÃ i dá»… vÃ  tÄƒng dáº§n Ä‘á»™ khÃ³ theo thá»i gian.');        } else {          recommendations.push('Má»—i ngÃ y 15 phÃºt giáº£i logic puzzle trÃªn Brilliant.org, sau 2 tuáº§n tÄƒng Ä‘á»™ khÃ³. Ghi chÃ©p tiáº¿n bá»™ Ä‘á»ƒ táº¡o Ä‘á»™ng lá»±c. Báº¯t Ä‘áº§u tá»« bÃ i dá»… Ä‘á»ƒ xÃ¢y dá»±ng sá»± tá»± tin.');          recommendations.push('LÃ m Sudoku dá»… 10 phÃºt má»—i ngÃ y Ä‘á»ƒ rÃ¨n luyá»‡n kháº£ nÄƒng nháº­n diá»‡n máº«u cÆ¡ báº£n. Sau 2 tuáº§n, chuyá»ƒn sang má»©c trung bÃ¬nh vÃ  tiáº¿p tá»¥c phÃ¡t triá»ƒn ká»¹ nÄƒng má»™t cÃ¡ch tá»« tá»«.');          recommendations.push('RÃ¨n luyá»‡n tÆ° duy logic báº±ng cÃ¡ch phÃ¢n tÃ­ch cÃ¡c váº¥n Ä‘á» hÃ ng ngÃ y má»™t cÃ¡ch cÃ³ há»‡ thá»‘ng. VÃ­ dá»¥ nhÆ° tá»‘i Æ°u hÃ³a mua sáº¯m hoáº·c quáº£n lÃ½ thá»i gian, báº¯t Ä‘áº§u tá»« nhá»¯ng váº¥n Ä‘á» thá»±c táº¿ vÃ  dá»… Ã¡p dá»¥ng.');        }      } else {        recommendations.push('Táº¡o lá»‹ch há»c cÃ³ káº¿ hoáº¡ch, má»—i Chá»§ nháº­t láº­p káº¿ hoáº¡ch tuáº§n sau. Sá»­ dá»¥ng Google Calendar Ä‘á»ƒ quáº£n lÃ½ thá»i gian, vÃ  dÃ nh thá»i gian cho cáº£ viá»‡c há»c thÆ°á»ng xuyÃªn vÃ  giáº£i logic puzzle Ä‘á»ƒ phÃ¡t triá»ƒn toÃ n diá»‡n. Äá»‹nh ká»³ xem xÃ©t láº¡i tiáº¿n Ä‘á»™ Ä‘á»ƒ Ä‘iá»u chá»‰nh káº¿ hoáº¡ch.');        recommendations.push('XÃ¡c Ä‘á»‹nh thá»i gian há»c tá»‘t nháº¥t phÃ¹ há»£p vá»›i tÃ­nh cÃ¡ch, sáº¯p xáº¿p bÃ i khÃ³ vÃ o lÃºc Ä‘Ã³. Giáº£i logic puzzle vÃ o buá»•i sÃ¡ng khi Ä‘áº§u Ã³c minh máº«n sáº½ Ä‘áº¡t hiá»‡u quáº£ cao hÆ¡n. TÃ¬m khÃ´ng gian yÃªn tÄ©nh nhÆ° thÆ° viá»‡n hoáº·c quÃ¡n cÃ  phÃª Ä‘á»ƒ táº­p trung tá»‘t hÆ¡n.');        recommendations.push('Tham gia há»c nhÃ³m hoáº·c tháº£o luáº­n 2-3 láº§n/tuáº§n Ä‘á»ƒ táº­n dá»¥ng tÃ­nh hÆ°á»›ng ngoáº¡i, giÃºp hiá»ƒu sÃ¢u hÆ¡n vÃ  duy trÃ¬ Ä‘á»™ng lá»±c. Äá»“ng thá»i, dÃ nh thá»i gian má»™t mÃ¬nh Ä‘á»ƒ giáº£i logic puzzle, rÃ¨n luyá»‡n kháº£ nÄƒng táº­p trung vÃ  tÆ° duy Ä‘á»™c láº­p.');      }    }    return recommendations.slice(0, 3);  }  async generateTeachingRecommendations(studentData) {    const { studentName, oceanResult, logicalResult, language = 'ja', mode = 'combined' } = studentData;    try {      const result = generateTeachingRecs({        oceanResult,        logicalResult,        language,        mode,      });      return result;    } catch (error) {      console.error('âŒ Generate teaching recommendations error:', error);      return {        success: false,        recommendations: language === 'ja'           ? ['ã“ã®å­¦ç”Ÿã®æ€§æ ¼ç‰¹æ€§ã«åˆã‚ã›ã¦ã€æˆæ¥­ä¸­ã¯ç©æ¥µçš„ã«è³ªå•ã‚’ä¿ƒã—ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã®æ©Ÿä¼šã‚’å¤šãè¨­ã‘ã¦ãã ã•ã„ã€‚', 'èª²é¡Œã¯æ®µéšçš„ã«é›£æ˜“åº¦ã‚’ä¸Šã’ã€å…·ä½“çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ã“ã¨ã§å­¦ç¿’æ„æ¬²ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚', 'å­¦ç”Ÿã®è«–ç†çš„æ€è€ƒèƒ½åŠ›ã«å¿œã˜ã¦ã€å•é¡Œè§£æ±ºå‹ã®èª²é¡Œã‚’å¤šãå‡ºã—ã€å®Ÿè·µçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚']          : ['Dá»±a trÃªn tÃ­nh cÃ¡ch cá»§a há»c sinh nÃ y, trong lá»›p hÃ£y khuyáº¿n khÃ­ch Ä‘áº·t cÃ¢u há»i vÃ  táº¡o nhiá»u cÆ¡ há»™i tháº£o luáº­n nhÃ³m.', 'Giao bÃ i táº­p vá»›i Ä‘á»™ khÃ³ tÄƒng dáº§n vÃ  cung cáº¥p pháº£n há»“i cá»¥ thá»ƒ Ä‘á»ƒ duy trÃ¬ Ä‘á»™ng lá»±c há»c táº­p.', 'Dá»±a trÃªn kháº£ nÄƒng tÆ° duy logic cá»§a há»c sinh, hÃ£y giao nhiá»u bÃ i táº­p giáº£i quyáº¿t váº¥n Ä‘á» vÃ  chÃº trá»ng phÆ°Æ¡ng phÃ¡p thá»±c táº¿.'],        rawResponse: null,        error: error.message,      };    }  }  buildTeachingPrompt(data) {    const { studentName, oceanResult, logicalResult, language, mode = 'combined' } = data;    let systemPrompt = language === 'ja'      ? 'ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªæ•™è‚²å¿ƒç†å­¦è€…ã§ã€æ•™å¸«å‘ã‘ã®æŒ‡å°æ–¹æ³•ã‚’ææ¡ˆã™ã‚‹å°‚é–€å®¶ã§ã™ã€‚å­¦ç”Ÿã®æ€§æ ¼è¨ºæ–­ã¨ãƒ†ã‚¹ãƒˆçµæœã‚’æ·±ãåˆ†æã—ã€ãã®å­¦ç”Ÿã«æœ€é©ãªå…·ä½“çš„ã§å®Ÿè·µçš„ãªæŒ‡å°æ–¹æ³•ã‚’æ•™å¸«ã«ææ¡ˆã—ã¦ãã ã•ã„ã€‚å„æ¨å¥¨ã¯è©³ç´°ã§ã€å®Ÿè¡Œæ–¹æ³•ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã€å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n'      : 'Báº¡n lÃ  nhÃ  tÃ¢m lÃ½ giÃ¡o dá»¥c giÃ u kinh nghiá»‡m, chuyÃªn Ä‘á» xuáº¥t phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cho giÃ¡o viÃªn. HÃ£y phÃ¢n tÃ­ch sÃ¢u káº¿t quáº£ kiá»ƒm tra vÃ  Ä‘Æ°a ra phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cá»¥ thá»ƒ, thá»±c táº¿ phÃ¹ há»£p vá»›i há»c sinh nÃ y. Má»—i gá»£i Ã½ pháº£i chi tiáº¿t vá»›i cÃ¡ch thá»±c hiá»‡n, hiá»‡u quáº£ mong Ä‘á»£i, vÃ  tÃ i nguyÃªn cáº§n thiáº¿t.\n\n';    if (language === 'ja') {      let prompt = systemPrompt + `å­¦ç”Ÿå: ${studentName}\n\n`;      if (oceanResult && oceanResult.scores) {        prompt += `OCEANæ€§æ ¼è¨ºæ–­çµæœ:\n`;        prompt += `- ç¥çµŒç—‡å‚¾å‘: ${oceanResult.scores.neuroticism}%\n`;        prompt += `- å¤–å‘æ€§: ${oceanResult.scores.extraversion}%\n`;        prompt += `- é–‹æ”¾æ€§: ${oceanResult.scores.openness}%\n`;        prompt += `- å”èª¿æ€§: ${oceanResult.scores.agreeableness}%\n`;        prompt += `- èª å®Ÿæ€§: ${oceanResult.scores.conscientiousness}%\n`;        prompt += `å„ªä½ãªç‰¹æ€§: ${oceanResult.dominantTrait}\n\n`;      }      if (logicalResult) {        prompt += `è«–ç†çš„æ¨è«–ãƒ†ã‚¹ãƒˆçµæœ:\n`;        prompt += `- æ­£è§£ç‡: ${logicalResult.percentage}%\n`;        prompt += `- æ­£è§£æ•°: ${logicalResult.correctCount}/${logicalResult.totalQuestions}\n\n`;      }      prompt += `ä¸Šè¨˜ã®å­¦ç”Ÿãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã€æ•™å¸«ãŒã“ã®å­¦ç”Ÿã‚’åŠ¹æœçš„ã«æŒ‡å°ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªæ–¹æ³•ã‚’3å€‹ææ¡ˆã—ã¦ãã ã•ã„:\n`;      prompt += `1. å„ææ¡ˆã¯3-4æ–‡ã§ã€å…·ä½“çš„ãªæŒ‡å°æ–¹æ³•ã€å®Ÿè¡Œæ‰‹é †ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã‚’å«ã‚ã¦ãã ã•ã„\n`;      prompt += `2. æˆæ¥­ä¸­ã®å¯¾å¿œã€èª²é¡Œã®å‡ºã—æ–¹ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®æ–¹æ³•ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ–¹æ³•ã€è©•ä¾¡æ–¹æ³•ãªã©å¤šæ§˜ãªå´é¢ã‚’ã‚«ãƒãƒ¼\n`;      prompt += `3. å„æ¨å¥¨ã«ã¯å…·ä½“çš„ãªä¾‹ã€æ™‚é–“é…åˆ†ã€é »åº¦ã€ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„\n`;      prompt += `4. å­¦ç”Ÿã®æ€§æ ¼ç‰¹æ€§ã¨è«–ç†èƒ½åŠ›ã«åˆã‚ã›ãŸå€‹åˆ¥åŒ–ã•ã‚ŒãŸæŒ‡å°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¦ãã ã•ã„\n`;      prompt += `\nğŸ”´é‡è¦: å„æ¨å¥¨ã¯å¿…ãš3-4æ–‡ã§è©³ç´°ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚å…·ä½“çš„ãªæŒ‡å°æ–¹æ³•ã€å®Ÿè¡Œæ‰‹é †ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚\n`;      prompt += `ğŸ”´å½¢å¼: å„æ¨å¥¨ã¯å¿…ãšç•ªå·ä»˜ããƒªã‚¹ãƒˆã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n`;      prompt += `ä¾‹:\n`;      prompt += `1. [æŒ‡å°æ–¹æ³•1 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `2. [æŒ‡å°æ–¹æ³•2 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `3. [æŒ‡å°æ–¹æ³•3 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `å¿…ãš3å€‹ã®æ¨å¥¨ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚å„æ¨å¥¨ã¯ç‹¬ç«‹ã—ãŸè¡Œã§ã€ç•ªå·ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n`;      return prompt;    } else {      let prompt = systemPrompt + `TÃªn há»c sinh: ${studentName}\n\n`;      if (oceanResult && oceanResult.scores) {        prompt += `Káº¿t quáº£ OCEAN:\n`;        prompt += `- Xu hÆ°á»›ng tháº§n kinh: ${oceanResult.scores.neuroticism}%\n`;        prompt += `- HÆ°á»›ng ngoáº¡i: ${oceanResult.scores.extraversion}%\n`;        prompt += `- Cá»Ÿi má»Ÿ: ${oceanResult.scores.openness}%\n`;        prompt += `- Dá»… chá»‹u: ${oceanResult.scores.agreeableness}%\n`;        prompt += `- Táº­n tÃ¢m: ${oceanResult.scores.conscientiousness}%\n`;        prompt += `Äáº·c Ä‘iá»ƒm ná»•i báº­t: ${oceanResult.dominantTrait}\n\n`;      }      if (logicalResult) {        prompt += `Káº¿t quáº£ Logical:\n`;        prompt += `- Tá»· lá»‡: ${logicalResult.percentage}%\n`;        prompt += `- ÄÃºng: ${logicalResult.correctCount}/${logicalResult.totalQuestions}\n\n`;      }      prompt += `Dá»±a trÃªn dá»¯ liá»‡u há»c sinh trÃªn, Ä‘á» xuáº¥t 3 phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cá»¥ thá»ƒ cho giÃ¡o viÃªn:\n`;      prompt += `1. Má»—i gá»£i Ã½ 3-4 cÃ¢u, bao gá»“m phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cá»¥ thá»ƒ, cÃ¡ch thá»±c hiá»‡n, káº¿t quáº£ mong Ä‘á»£i\n`;      prompt += `2. Bao gá»“m: cÃ¡ch á»©ng xá»­ trong lá»›p, cÃ¡ch giao bÃ i táº­p, cÃ¡ch pháº£n há»“i, cÃ¡ch giao tiáº¿p, cÃ¡ch Ä‘Ã¡nh giÃ¡\n`;      prompt += `3. Má»—i gá»£i Ã½ pháº£i cÃ³ vÃ­ dá»¥ cá»¥ thá»ƒ, thá»i gian, táº§n suáº¥t, cÃ´ng cá»¥ sá»­ dá»¥ng\n`;      prompt += `4. Äá» xuáº¥t phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cÃ¡ nhÃ¢n hÃ³a dá»±a trÃªn tÃ­nh cÃ¡ch vÃ  kháº£ nÄƒng logic cá»§a há»c sinh\n`;      prompt += `\nğŸ”´QUAN TRá»ŒNG: Má»—i gá»£i Ã½ PHáº¢I 3-4 cÃ¢u vá»›i PHÆ¯Æ NG PHÃP GIáº¢NG Dáº Y Cá»¤ THá»‚, CÃCH THá»°C HIá»†N, Káº¾T QUáº¢ MONG Äá»¢I!\n`;      prompt += `ğŸ”´Äá»‹nh dáº¡ng: Má»—i gá»£i Ã½ pháº£i lÃ  danh sÃ¡ch cÃ³ sá»‘ thá»© tá»±, má»—i gá»£i Ã½ trÃªn 1 dÃ²ng riÃªng:\n`;      prompt += `VÃ­ dá»¥:\n`;      prompt += `1. [PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y 1 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `2. [PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y 2 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `3. [PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y 3 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `Báº®T BUá»˜C pháº£i cÃ³ 3 gá»£i Ã½. Má»—i gá»£i Ã½ pháº£i báº¯t Ä‘áº§u báº±ng sá»‘ thá»© tá»± (1. 2. 3.) vÃ  náº±m trÃªn dÃ²ng riÃªng.\n`;      return prompt;    }  }  getFallbackTeachingRecommendations(data) {    const { language = 'ja', oceanResult, logicalResult } = data;    const recommendations = [];    if (language === 'ja') {      recommendations.push('ã“ã®å­¦ç”Ÿã®æ€§æ ¼ç‰¹æ€§ã«åˆã‚ã›ã¦ã€æˆæ¥­ä¸­ã¯ç©æ¥µçš„ã«è³ªå•ã‚’ä¿ƒã—ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã®æ©Ÿä¼šã‚’å¤šãè¨­ã‘ã¦ãã ã•ã„ã€‚');      recommendations.push('èª²é¡Œã¯æ®µéšçš„ã«é›£æ˜“åº¦ã‚’ä¸Šã’ã€å…·ä½“çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ã“ã¨ã§å­¦ç¿’æ„æ¬²ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚');      recommendations.push('å­¦ç”Ÿã®è«–ç†çš„æ€è€ƒèƒ½åŠ›ã«å¿œã˜ã¦ã€å•é¡Œè§£æ±ºå‹ã®èª²é¡Œã‚’å¤šãå‡ºã—ã€å®Ÿè·µçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚');    } else {      recommendations.push('Dá»±a trÃªn tÃ­nh cÃ¡ch cá»§a há»c sinh nÃ y, trong lá»›p hÃ£y khuyáº¿n khÃ­ch Ä‘áº·t cÃ¢u há»i vÃ  táº¡o nhiá»u cÆ¡ há»™i tháº£o luáº­n nhÃ³m.');      recommendations.push('Giao bÃ i táº­p vá»›i Ä‘á»™ khÃ³ tÄƒng dáº§n vÃ  cung cáº¥p pháº£n há»“i cá»¥ thá»ƒ Ä‘á»ƒ duy trÃ¬ Ä‘á»™ng lá»±c há»c táº­p.');      recommendations.push('Dá»±a trÃªn kháº£ nÄƒng tÆ° duy logic cá»§a há»c sinh, hÃ£y giao nhiá»u bÃ i táº­p giáº£i quyáº¿t váº¥n Ä‘á» vÃ  chÃº trá»ng phÆ°Æ¡ng phÃ¡p thá»±c táº¿.');    }    return recommendations;  }  async generateClassTeachingRecommendations(classData) {    const { className, oceanAverages, logicalAverage, distribution, language = 'ja' } = classData;    try {      const result = generateClassTeachingRecs({        oceanAverages,        logicalAverage,        distribution,        language,      });      return result;    } catch (error) {      console.error('âŒ Generate class teaching recommendations error:', error);      return {        success: false,        recommendations: language === 'ja'           ? ['ã‚¯ãƒ©ã‚¹ã®å¤šæ§˜æ€§ã‚’è€ƒæ…®ã—ã€æ§˜ã€…ãªå­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã«å¯¾å¿œã§ãã‚‹æŸ”è»ŸãªæŒ‡å°æ–¹æ³•ã‚’æ¡ç”¨ã—ã¦ãã ã•ã„ã€‚', 'ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¯ãƒ¼ã‚¯ã¨å€‹äººä½œæ¥­ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã€ç•°ãªã‚‹æ€§æ ¼ã‚¿ã‚¤ãƒ—ã®å­¦ç”ŸãŒæ´»èºã§ãã‚‹æ©Ÿä¼šã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚', 'å®šæœŸçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­ã‘ã€å­¦ç”Ÿã®ç†è§£åº¦ã¨å­¦ç¿’é€²åº¦ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚']          : ['Xem xÃ©t sá»± Ä‘a dáº¡ng cá»§a lá»›p, Ã¡p dá»¥ng phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y linh hoáº¡t phÃ¹ há»£p vá»›i nhiá»u phong cÃ¡ch há»c táº­p khÃ¡c nhau.', 'CÃ¢n báº±ng giá»¯a lÃ m viá»‡c nhÃ³m vÃ  cÃ¡ nhÃ¢n, táº¡o cÆ¡ há»™i cho cÃ¡c loáº¡i tÃ­nh cÃ¡ch khÃ¡c nhau thá»ƒ hiá»‡n.', 'Tá»• chá»©c cÃ¡c buá»•i pháº£n há»“i Ä‘á»‹nh ká»³ Ä‘á»ƒ kiá»ƒm tra má»©c Ä‘á»™ hiá»ƒu vÃ  tiáº¿n Ä‘á»™ há»c táº­p cá»§a há»c sinh.'],        rawResponse: null,        error: error.message,      };    }  }  buildClassTeachingPrompt(data) {    const { className, oceanAverages, logicalAverage, distribution, language = 'ja' } = data;    let systemPrompt = language === 'ja'      ? 'ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªæ•™è‚²å¿ƒç†å­¦è€…ã§ã€ã‚¯ãƒ©ã‚¹å…¨ä½“ã®æŒ‡å°æ–¹æ³•ã‚’ææ¡ˆã™ã‚‹å°‚é–€å®¶ã§ã™ã€‚ã‚¯ãƒ©ã‚¹ã®å¹³å‡çš„ãªæ€§æ ¼ç‰¹æ€§ã¨åˆ†å¸ƒã‚’æ·±ãåˆ†æã—ã€ã‚¯ãƒ©ã‚¹å…¨ä½“ã«é©ã—ãŸå…·ä½“çš„ã§å®Ÿè·µçš„ãªæŒ‡å°æ–¹æ³•ã‚’æ•™å¸«ã«ææ¡ˆã—ã¦ãã ã•ã„ã€‚å„æ¨å¥¨ã¯è©³ç´°ã§ã€å®Ÿè¡Œæ–¹æ³•ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã€å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n'      : 'Báº¡n lÃ  nhÃ  tÃ¢m lÃ½ giÃ¡o dá»¥c giÃ u kinh nghiá»‡m, chuyÃªn Ä‘á» xuáº¥t phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cho cáº£ lá»›p. HÃ£y phÃ¢n tÃ­ch sÃ¢u cÃ¡c Ä‘áº·c Ä‘iá»ƒm tÃ­nh cÃ¡ch trung bÃ¬nh vÃ  phÃ¢n bá»‘ cá»§a lá»›p, Ä‘Æ°a ra phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cá»¥ thá»ƒ, thá»±c táº¿ phÃ¹ há»£p vá»›i cáº£ lá»›p. Má»—i gá»£i Ã½ pháº£i chi tiáº¿t vá»›i cÃ¡ch thá»±c hiá»‡n, hiá»‡u quáº£ mong Ä‘á»£i, vÃ  tÃ i nguyÃªn cáº§n thiáº¿t.\n\n';    if (language === 'ja') {      let prompt = systemPrompt + `ã‚¯ãƒ©ã‚¹å: ${className}\n\n`;      if (oceanAverages) {        prompt += `ã‚¯ãƒ©ã‚¹å¹³å‡OCEANã‚¹ã‚³ã‚¢:\n`;        prompt += `- ç¥çµŒç—‡å‚¾å‘ (N): ${oceanAverages.neuroticism || 0}%\n`;        prompt += `- å¤–å‘æ€§ (E): ${oceanAverages.extraversion || 0}%\n`;        prompt += `- é–‹æ”¾æ€§ (O): ${oceanAverages.openness || 0}%\n`;        prompt += `- å”èª¿æ€§ (A): ${oceanAverages.agreeableness || 0}%\n`;        prompt += `- èª å®Ÿæ€§ (C): ${oceanAverages.conscientiousness || 0}%\n\n`;      }      if (logicalAverage !== undefined) {        prompt += `è«–ç†çš„æ¨è«–ãƒ†ã‚¹ãƒˆå¹³å‡: ${logicalAverage}%\n\n`;      }      if (distribution && distribution.length > 0) {        prompt += `å­¦ç”Ÿã®æ€§æ ¼ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ:\n`;        distribution.forEach(item => {          prompt += `- ${item.type}: ${item.count}äºº (${item.percentage}%)\n`;        });        prompt += `\n`;      }      prompt += `ä¸Šè¨˜ã®ã‚¯ãƒ©ã‚¹ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã€æ•™å¸«ãŒã“ã®ã‚¯ãƒ©ã‚¹å…¨ä½“ã‚’åŠ¹æœçš„ã«æŒ‡å°ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªæ–¹æ³•ã‚’3å€‹ææ¡ˆã—ã¦ãã ã•ã„:\n`;      prompt += `1. å„ææ¡ˆã¯3-4æ–‡ã§ã€å…·ä½“çš„ãªæŒ‡å°æ–¹æ³•ã€å®Ÿè¡Œæ‰‹é †ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã‚’å«ã‚ã¦ãã ã•ã„\n`;      prompt += `2. ã‚¯ãƒ©ã‚¹å…¨ä½“ã®å¤šæ§˜æ€§ã‚’è€ƒæ…®ã—ã€ç•°ãªã‚‹æ€§æ ¼ã‚¿ã‚¤ãƒ—ã®å­¦ç”Ÿã«å¯¾å¿œã§ãã‚‹æ–¹æ³•ã‚’ææ¡ˆã—ã¦ãã ã•ã„\n`;      prompt += `3. æˆæ¥­ä¸­ã®å¯¾å¿œã€èª²é¡Œã®å‡ºã—æ–¹ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®æ–¹æ³•ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ–¹æ³•ã€è©•ä¾¡æ–¹æ³•ãªã©å¤šæ§˜ãªå´é¢ã‚’ã‚«ãƒãƒ¼\n`;      prompt += `4. å„æ¨å¥¨ã«ã¯å…·ä½“çš„ãªä¾‹ã€æ™‚é–“é…åˆ†ã€é »åº¦ã€ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„\n`;      prompt += `5. ã‚¯ãƒ©ã‚¹ã®å¹³å‡çš„ãªç‰¹æ€§ã¨åˆ†å¸ƒã«åˆã‚ã›ãŸåŒ…æ‹¬çš„ãªæŒ‡å°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¦ãã ã•ã„\n`;      prompt += `\nğŸ”´é‡è¦: å„æ¨å¥¨ã¯å¿…ãš3-4æ–‡ã§è©³ç´°ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚å…·ä½“çš„ãªæŒ‡å°æ–¹æ³•ã€å®Ÿè¡Œæ‰‹é †ã€æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚\n`;      prompt += `ğŸ”´å½¢å¼: å„æ¨å¥¨ã¯å¿…ãšç•ªå·ä»˜ããƒªã‚¹ãƒˆã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n`;      prompt += `ä¾‹:\n`;      prompt += `1. [æŒ‡å°æ–¹æ³•1 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `2. [æŒ‡å°æ–¹æ³•2 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `3. [æŒ‡å°æ–¹æ³•3 - 3-4æ–‡ã§è©³ç´°ã«]\n`;      prompt += `å¿…ãš3å€‹ã®æ¨å¥¨ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚å„æ¨å¥¨ã¯ç‹¬ç«‹ã—ãŸè¡Œã§ã€ç•ªå·ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n`;      return prompt;    } else {      let prompt = systemPrompt + `TÃªn lá»›p: ${className}\n\n`;      if (oceanAverages) {        prompt += `Äiá»ƒm trung bÃ¬nh OCEAN cá»§a lá»›p:\n`;        prompt += `- Xu hÆ°á»›ng tháº§n kinh (N): ${oceanAverages.neuroticism || 0}%\n`;        prompt += `- HÆ°á»›ng ngoáº¡i (E): ${oceanAverages.extraversion || 0}%\n`;        prompt += `- Cá»Ÿi má»Ÿ (O): ${oceanAverages.openness || 0}%\n`;        prompt += `- Dá»… chá»‹u (A): ${oceanAverages.agreeableness || 0}%\n`;        prompt += `- Táº­n tÃ¢m (C): ${oceanAverages.conscientiousness || 0}%\n\n`;      }      if (logicalAverage !== undefined) {        prompt += `Äiá»ƒm trung bÃ¬nh Logical: ${logicalAverage}%\n\n`;      }      if (distribution && distribution.length > 0) {        prompt += `PhÃ¢n bá»‘ tÃ­nh cÃ¡ch há»c sinh trong lá»›p:\n`;        distribution.forEach(item => {          prompt += `- ${item.type}: ${item.count} há»c sinh (${item.percentage}%)\n`;        });        prompt += `\n`;      }      prompt += `Dá»±a trÃªn dá»¯ liá»‡u lá»›p trÃªn, Ä‘á» xuáº¥t 3 phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cá»¥ thá»ƒ cho giÃ¡o viÃªn Ä‘á»ƒ giáº£ng dáº¡y cáº£ lá»›p:\n`;      prompt += `1. Má»—i gá»£i Ã½ 3-4 cÃ¢u, bao gá»“m phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y cá»¥ thá»ƒ, cÃ¡ch thá»±c hiá»‡n, káº¿t quáº£ mong Ä‘á»£i\n`;      prompt += `2. Xem xÃ©t sá»± Ä‘a dáº¡ng cá»§a lá»›p, Ä‘á» xuáº¥t phÆ°Æ¡ng phÃ¡p cÃ³ thá»ƒ phÃ¹ há»£p vá»›i cÃ¡c loáº¡i tÃ­nh cÃ¡ch khÃ¡c nhau\n`;      prompt += `3. Bao gá»“m: cÃ¡ch á»©ng xá»­ trong lá»›p, cÃ¡ch giao bÃ i táº­p, cÃ¡ch pháº£n há»“i, cÃ¡ch giao tiáº¿p, cÃ¡ch Ä‘Ã¡nh giÃ¡\n`;      prompt += `4. Má»—i gá»£i Ã½ pháº£i cÃ³ vÃ­ dá»¥ cá»¥ thá»ƒ, thá»i gian, táº§n suáº¥t, cÃ´ng cá»¥ sá»­ dá»¥ng\n`;      prompt += `5. Äá» xuáº¥t phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y toÃ n diá»‡n phÃ¹ há»£p vá»›i Ä‘áº·c Ä‘iá»ƒm trung bÃ¬nh vÃ  phÃ¢n bá»‘ cá»§a lá»›p\n`;      prompt += `\nğŸ”´QUAN TRá»ŒNG: Má»—i gá»£i Ã½ PHáº¢I 3-4 cÃ¢u vá»›i PHÆ¯Æ NG PHÃP GIáº¢NG Dáº Y Cá»¤ THá»‚, CÃCH THá»°C HIá»†N, Káº¾T QUáº¢ MONG Äá»¢I!\n`;      prompt += `ğŸ”´Äá»‹nh dáº¡ng: Má»—i gá»£i Ã½ pháº£i lÃ  danh sÃ¡ch cÃ³ sá»‘ thá»© tá»±, má»—i gá»£i Ã½ trÃªn 1 dÃ²ng riÃªng:\n`;      prompt += `VÃ­ dá»¥:\n`;      prompt += `1. [PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y 1 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `2. [PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y 2 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `3. [PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y 3 - 3-4 cÃ¢u chi tiáº¿t]\n`;      prompt += `Báº®T BUá»˜C pháº£i cÃ³ 3 gá»£i Ã½. Má»—i gá»£i Ã½ pháº£i báº¯t Ä‘áº§u báº±ng sá»‘ thá»© tá»± (1. 2. 3.) vÃ  náº±m trÃªn dÃ²ng riÃªng.\n`;      return prompt;    }  }  getFallbackClassTeachingRecommendations(data) {    const { language = 'ja' } = data;    const recommendations = [];    if (language === 'ja') {      recommendations.push('ã‚¯ãƒ©ã‚¹ã®å¤šæ§˜æ€§ã‚’è€ƒæ…®ã—ã€æ§˜ã€…ãªå­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã«å¯¾å¿œã§ãã‚‹æŸ”è»ŸãªæŒ‡å°æ–¹æ³•ã‚’æ¡ç”¨ã—ã¦ãã ã•ã„ã€‚');      recommendations.push('ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¯ãƒ¼ã‚¯ã¨å€‹äººä½œæ¥­ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã€ç•°ãªã‚‹æ€§æ ¼ã‚¿ã‚¤ãƒ—ã®å­¦ç”ŸãŒæ´»èºã§ãã‚‹æ©Ÿä¼šã‚’è¨­ã‘ã¦ãã ã•ã„ã€‚');      recommendations.push('å®šæœŸçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¨­ã‘ã€å­¦ç”Ÿã®ç†è§£åº¦ã¨å­¦ç¿’é€²åº¦ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');    } else {      recommendations.push('Xem xÃ©t sá»± Ä‘a dáº¡ng cá»§a lá»›p, Ã¡p dá»¥ng phÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y linh hoáº¡t phÃ¹ há»£p vá»›i nhiá»u phong cÃ¡ch há»c táº­p khÃ¡c nhau.');      recommendations.push('CÃ¢n báº±ng giá»¯a lÃ m viá»‡c nhÃ³m vÃ  cÃ¡ nhÃ¢n, táº¡o cÆ¡ há»™i cho cÃ¡c loáº¡i tÃ­nh cÃ¡ch khÃ¡c nhau thá»ƒ hiá»‡n.');      recommendations.push('Tá»• chá»©c cÃ¡c buá»•i pháº£n há»“i Ä‘á»‹nh ká»³ Ä‘á»ƒ kiá»ƒm tra má»©c Ä‘á»™ hiá»ƒu vÃ  tiáº¿n Ä‘á»™ há»c táº­p cá»§a há»c sinh.');    }    return recommendations;  }}export default new AIServiceGemini();